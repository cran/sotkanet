[Sotkanet-indikaattoripankki](http://uusi.sotkanet.fi/portal/page/portal/etusivu/tietoa_palvelusta)
on Terveyden ja hyvinvoinnin laitoksen (THL) ylläpitämä palvelu, josta
löytyy yli 2000 väestörakenteeseen ja hyvinvointiin liittyvää
indikaattoria Suomessa ja Euroopanlaajuisesti. Saatavilla olevia
indikaattoreita voi selata SOTKAnetin
[portaalissa](http://uusi.sotkanet.fi/portal/page/portal/etusivu/hakusivu).

Tälle sivulle on koottu esimerkkejä Sotkanetin indikaattoridatan
lukemisesta R-kielisillä hakurutiineilla, jotka on laadittu
[Opasnetin](http://fi.opasnet.org/fi/Etusivu) ja
[Louhoksen](http://louhos.github.com/sorvi)
yhteistyönä. Lisäesimerkkejä löydät
[takomosta](https://github.com/louhos/takomo/tree/master/Sotkanet). SOTKAnetin
sivuilta löytyy tarvittaessa [rajapinnan täysi
kuvaus](http://uusi.sotkanet.fi/portal/pls/portal/!PORTAL.wwpob_page.show?_docname=22001.PDF).

R-hakurutiineja käytettäessä on huomioitava, että SOTKAnetin API on
tarkoitettu tietojen noutamiseen erissä käytettäväksi eri
sovelluksissa; rajapintaa ei ole tarkoitettu suoraan käyttöön.
Aineistojen täydet käyttöehdot löydät [SOTKAnetin
sivuilta](http://uusi.sotkanet.fi/portal/page/portal/etusivu/tietoa_palvelusta). 


### Listaa saatavilla olevat SOTKAnetin indikaattorit

```{r sotkanetIndicators, warning=FALSE, message=FALSE}
library(sotkanet) 
sotkanet.indicators <- SotkanetIndicators(type = "table")
head(sotkanet.indicators)
```

### Listaa SOTKAnetin aluetiedot

Tämä toiminto listaa tiedot alueista, joihin liittyviä tietoja löytyy
SOTKAnet-tietokannasta:

```{r sotkanetRegions, warning=FALSE, message=FALSE}
sotkanet.regions <- SotkanetRegions(type = "table")
head(sotkanet.regions)
```

### Hae indikaattoridataa

Hae [indikaattoria 10013](http://uusi.sotkanet.fi/portal/page/portal/etusivu/hakusivu/metadata?type=I&indicator=10013) vastaava data Suomesta vuosilta 1990-2012 (Eurostatin Työmarkkinatilaston nuorisotyöttömyysaste), ja piirrä kuvaaja:

```{r sotkanetData, warning=FALSE, message=FALSE}
# Get indicator data
dat <- GetDataSotkanet(indicators = 10013, years = 1990:2012, 
       		       genders = c('female', 'male', 'total'), 
		       region.category = "EUROOPPA", 
		       region = "Suomi")

# Translate gender names
dat$Sukupuoli <- dat$gender
dat$Sukupuoli <- gsub("female", "nainen", dat$Sukupuoli)
dat$Sukupuoli <- gsub("male", "mies", dat$Sukupuoli)
dat$Sukupuoli <- gsub("total", "ihminen", dat$Sukupuoli)
dat$Sukupuoli <- factor(dat$Sukupuoli)

# Investigate the first lines in the data
head(dat)

# Pick indicator name
indicator.name <- as.character(unique(dat$indicator.title.fi))
indicator.source <- as.character(unique(dat$indicator.organization.title.fi))

# Visualize
library(ggplot2, quietly=TRUE)
theme_set(theme_bw(20)); 
p <- ggplot(dat, aes(x = year, y = primary.value, group = Sukupuoli, color = Sukupuoli)) 
p <- p + geom_line() + ggtitle(paste(indicator.name, indicator.source, sep = " / ")) 
p <- p + xlab("Vuosi") + ylab("Arvo") 
p <- p + theme(title = element_text(size = 10))
p <- p + theme(axis.title.x = element_text(size = 20))
p <- p + theme(axis.title.y = element_text(size = 20))
p <- p + theme(legend.title = element_text(size = 15))
print(p)
```


### Indikaattorit Suomen kartalla

Yhdistä SOTKAnet-indikaattori dataa [Maanmittauslaitoksen
kartta-aineistoihin](Maanmittauslaitos) (C) MML 2011. Esimerkkinä
[indikaattori
178](http://uusi.sotkanet.fi/portal/page/portal/etusivu/hakusivu/metadata?type=I&indicator=178) (Nettomuutto / 1000 asukasta; (C) THL):

```{r sotkanetVisu2, warning=FALSE, message=FALSE}
# Get Data from SOTKAnet
#unique(subset(sotkanet.indicators, indicator.organization %in% c(2,30))[, 1:2])
selected.indicators <- "Nettomuutto / 1000 asukasta"; selected.inds <- sotkanet.indicators$indicator[match(selected.indicators, sotkanet.indicators$indicator.title.fi)]; print(selected.inds)

dat <- GetDataSotkanet(indicators = selected.inds, years = 2011, genders = c('total'))

# Pick indicator name and source
indicator.name <- as.character(unique(dat$indicator.title.fi))
indicator.source <- as.character(unique(dat$indicator.organization.title.fi))

# Load MML municipality map data (C) MML 2011
sp <- LoadMML(data.id = "kunta4_p", resolution = "4_5_milj_shape_etrs-tm35fin")

# Match municipality names between shape (map) object and indicator data
# and add indicator data to the shape object
sp[["indicator"]] <- dat[match(sp@data$Kunta.FI, dat$region.title.fi), "primary.value"]

# Replace NAs by 0
sp[["indicator"]][is.na(sp[["indicator"]])] <- 0

# Visualize the indicator on Finnish map
# Restrict the limits to +/-30 to keep contrast
q <- PlotShape(sp, "indicator", main = paste(indicator.name, indicator.source, sep = "/"), type = "twoway", at = seq(-30, 30, 1))
```

### Kuntien koko ja satunnaisvaihtelu

Analyysipuuskan iskiessä päälle kandee pitää mielessä, että asukasluvultaan pienempien kuntien luvuissa on enemmän satunnaisvaihtelua kuten nähdään alla olevasta kuvasta. Kunnan nettomuutossa on suurempaa vaihtelua pienissä kunnissa. Työttömyysaste on osoitettu värein. Merkittävin nettomuutto (-146/1000 asukasta) on 103 asukkaan Sottungassa.

```{r sotkanetVisu3, warning=FALSE, message=FALSE}
selected.indicators <- c("Väestö 31.12.", "Nettomuutto / 1000 asukasta", "Työttömät, % työvoimasta"); 
selected.inds <- sotkanet.indicators$indicator[match(selected.indicators, sotkanet.indicators$indicator.title.fi)]
dat <- GetDataSotkanet(indicators = selected.inds, years = 2011, genders = c('total'))
datf <- dat[, c("region.title.fi", "indicator.title.fi", "primary.value")]
dw <- reshape(datf, idvar = "region.title.fi", timevar = "indicator.title.fi", direction = "wide")
names(dw) <- c("Kunta", "Asukasluku", "Nettomuutto", "Työttömyys")
p <- ggplot(dw, aes(x = log10(Asukasluku), y = Nettomuutto, color = Työttömyys)) + geom_point(size = 3)
p <- p + ggtitle("Kunnan asukasluku, nettomuutto ja työllisyys") 
p <- p + theme(title = element_text(size = 15))
p <- p + theme(axis.title.x = element_text(size = 20))
p <- p + theme(axis.title.y = element_text(size = 20))
p <- p + theme(legend.title = element_text(size = 15))
print(p)
```



### Hae kaikki tietokannan indikaattorit

Tämän hakutoiminnon ajamista suositellaan tehtäväksi vain
harvoin. Haku myös kestää pitkään. 

```{r sotkanetDataAll, warning=FALSE, message=FALSE, eval=FALSE}
# These indicators have problems with R routines:
probematic.indicators <- c(1575, 1743, 1826, 1861, 1882, 1924, 1952, 2000, 2001, 2033, 2050, 3386, 3443)

# Get data for all indicators
datlist <- list()
for (ind in setdiff(sotkanet.indicators$indicator, probematic.indicators) {
  datlist[[as.character(ind)]] <- GetDataSotkanet(indicators = ind, years = 1990:2013, genders = c('female', 'male', 'total'))
}

# Combine tables (this may require considerable time and memory 
# for the full data set)
dat <- do.call("rbind", datlist)
```

# Aineiston lisensointi ja käyttöehdot


Aineistojen täydet ja viralliset käyttöehdot löydät [SOTKAnetin sivuilta](http://uusi.sotkanet.fi/portal/page/portal/etusivu/tietoa_palvelusta). Olemme koostaneet alle keskeisimmät kohdat.

SOTKAnet REST API on tarkoitettu tietojen noutamiseen erissä
käytettäväksi eri sovelluksissa. Rajapintaa ei ole tarkoitettu suoraan
käyttöön.

SOTKAnetin rajapintaa saa käyttää vapaasti muiden järjestelmien
tietopohjana. Alueiden ja indikaattorien kuvailutieto julkaistaan
[Creative Commons Attribution
3.0-lisenssin (CC-BY 3.0)](http://creativecommons.org/licenses/by/3.0/)
mukaisesti. THL tuottamat tilastotiedot ja indikaattorit julkaistaan
CC-BY 3.0 –lisenssin mukaisesti. Muiden kuin
THL:n tuottamia tilastotietoja ja indikaattoreita saa käyttää vain ja
ainoastaan erillisen sopimuksen mukaisesti. Erillisessä sopimuksessa
osapuolina ovat rajapinnan käyttäjä, THL ja aineiston tuottaja.

CC-BY 3.0-lisenssin mukaisesti rajapinnan kautta saatua aineistoa
käytettäessä on mainittava lähteenä SOTKAnet ja tarjottava linkki
osoitteeseen [http://www.sotkanet.fi](http://www.sotkanet.fi/). Kunkin
aineiston osalta on mainittava erikseen tilaston tai indikaattorin
tuottajataho.

THL ei vastaa rajapintaa käyttävien sovellusten toiminnasta. THL
tuottaa rajapinnan sellaisenaan ilman takuita. Rajapintaa käytetään
omalla vastuulla.

### Versiotiedot

Tämä esimerkki on toteutettu seuraavin versiotiedoin:
 
```{r versiotiedot}
sessionInfo()
```


